<div class="page">
  <h1>Create New Budget</h1>
  <div class="page-content" *mobxAutorun>
    <form [formGroup]="budgetMetaForm">
      <mat-horizontal-stepper linear #stepper>
        <!-- Step 1 - handled with custom elements-->
        <mat-step>
          <ng-template matStepLabel>Enterprise</ng-template>
          <h2>What is your type of enterprise?</h2>
          <div style="display: flex; flex-wrap: wrap">
            <budget-card
              *ngFor="let type of store.enterpriseTypes"
              (click)="enterpriseTypeClicked(type)"
              [newCardId]="type"
              [selected]="selectedType === type"
              imageFormat="svg"
              @fadeInOut
            ></budget-card>
          </div>
          <h2 *ngIf="filteredEnterprises.length" @fadeInOut>
            Select Enterprise
          </h2>
          <div style="display: flex; flex-wrap: wrap">
            <budget-card
              *ngFor="let enterprise of filteredEnterprises"
              [card]="enterprise"
              (click)="enterpriseClicked(enterprise)"
              [selected]="budgetMetaForm.value.enterprise.id === enterprise.id"
              imageFormat="svg"
              @fadeInOut
            >
            </budget-card>
          </div>
          <div class="sticky-footer">
            <button
              matStepperNext
              color="primary"
              mat-raised-button
              class="footer-button"
              [disabled]="!budgetMetaForm.value.enterprise.id"
            >
              Next
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </mat-step>

        <!-- Step 2 - handled with form controls -->
        <mat-step>
          <ng-template matStepLabel>Length</ng-template>
          <h2>How long is your budget for?</h2>
          <div style="display: flex; flex-wrap: wrap">
            <button
              mat-button
              class="variable-container editable"
              (click)="periodTotalSelect.open()"
            >
              <span>{{ budgetMetaForm.value.lengthTotal }}</span>
              <mat-select
                class="select--hidden"
                #periodTotalSelect
                formControlName="lengthTotal"
                style="opacity: 0;"
              >
                <mat-option *ngFor="let n of periodTotalOptions" [value]="n">{{
                  n
                }}</mat-option>
              </mat-select>
            </button>

            <button
              mat-button
              class="variable-container editable"
              (click)="periodScaleSelect.open()"
            >
              <span>{{ budgetMetaForm.value.lengthScale }}</span>
              <mat-select
                class="select--hidden"
                #periodScaleSelect
                formControlName="lengthScale"
                style="opacity: 0;"
              >
                <mat-option
                  *ngFor="let option of periodScaleOptions"
                  [value]="option"
                  >{{ option }}</mat-option
                >
              </mat-select>
            </button>
            <div
              *ngIf="budgetMetaForm.value.lengthScale === 'months'"
              class="variable-container"
            >
              starting in
            </div>
            <button
              mat-button
              *ngIf="budgetMetaForm.value.lengthScale === 'months'"
              class="variable-container editable"
              (click)="periodStartSelect.open()"
            >
              <span>{{
                periodLabelOptions[budgetMetaForm.value.monthStart - 1]
              }}</span>
              <mat-select
                class="select--hidden"
                #periodStartSelect
                formControlName="monthStart"
                style="opacity: 0;"
              >
                <mat-option
                  *ngFor="let option of periodTotalOptions"
                  [value]="option"
                  >{{ periodLabelOptions[option - 1] }}</mat-option
                >
              </mat-select>
            </button>
          </div>
          <div class="sticky-footer">
            <button
              matStepperNext
              color="primary"
              mat-raised-button
              class="footer-button"
            >
              Next
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </mat-step>

        <!-- Step 3 -->
        <mat-step>
          <ng-template matStepLabel>Save</ng-template>
          <h2>Save your budget</h2>
          <input matInput placeholder="Title" formControlName="title" />
          <textarea
            matInput
            placeholder="Description (optional)"
            formControlName="description"
          ></textarea>
          <div class="sticky-footer">
            <button
              matStepperNext
              color="primary"
              mat-raised-button
              [disabled]="budgetMetaForm.invalid"
              class="footer-button"
              (click)="save()"
            >
              Save
            </button>
          </div>
        </mat-step>
      </mat-horizontal-stepper>
    </form>
  </div>
</div>
